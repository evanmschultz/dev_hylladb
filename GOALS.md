# HyllaDB Purpose and Goals

HyllaDB is meant to be a fast database built on the idea of a nesting of key-value pairs (Python Dictionaries).

## Goals

### Two Means of Storage and Retrieval

> **Note:** These means can be used in conjunction with each other, meaning you can have only part of the database in memory and the rest on disk for a balance of speed and memory usage.

1. **File and Directory Structure**

    - Slower lookup
        - Less memory usage
    - Persistence without fear of losing data

2. **In Memory**

    - Requires FastAPI
        - Faster lookup, more memory usage
    - Always asynchronously saves data to disk

        - If the server closes before operations are complete, data may be lost
        - Execute all non-READ operations in parallel on disk and in memory using threading, and ensure they are processed sequentially based on their path.

        #### TODO:

        - [ ] Set up safeguards to prevent data loss
            - Save data to disk before closing server
            - Save data to disk at regular intervals
            - Save data to disk when memory usage reaches a certain threshold
            - Test, make sure to check locks work as expected

## HyQL:

HyQL is the custom query language for HyllaDB. It is a non-syntactical language that uses objects (`Pydantic` models) in place of normal text.

-   [ ] Define all necessary models for CRUD operations
-   [ ] Setup a Universal Query Function.
    -   Implement a single function (use overload?), named hylla_query, capable of performing all CRUD operations based on its arguments.
-   [ ] Path mappings
    -   [ ] `paths` - Frozen sets (dictionaries):
        -   The key is the dot separated path used as input
        -   The value is an object that holds the `path` (the `Path` object to the `section` or `shelf`) and a dot separated path to access the nested key in the dictionary (use `glom`).
    -   [ ] `paths` set attribute of the `HyllaDB` class:
        -   When performing CRUD operations, throw an error if the `path` isn't in the `paths` set when it should be or when it shouldn't be yet it is.
        -   Update the `paths` set when adding or removing data.

1. `HyQL` -> `HyllaDB`
    1. Paths should be full path to nested dictionary key, meaning the dot separated syntax should map paths and the nested keys.
2. `HyllaDB` -> `HyQL`
    1. Define return types. Do we use autogenerated `Pydantic` models, `Pydantic` models that are defined by the user, or a standard return type that won't give IDE support?

## Development and Design Philosophy

### Docstrings Not Comments

Docstrings should be used in place of comments, and any internal code should have clear documentation stating the how, what, and why of the code. First, clearly state the purpose of the code, followed by its rationale, and then its methodology. After covering these aspects, add usage examples.

> **Note:** External-facing code should not include detailed explanations of the mechanics of the code. It should be as concise as possible for clarity and readability, while providing the detail necessary for the user.

**Example:**

    ````Python
    def func(arg1, arg2):
    """
    This function does something for the purpose of something.

        It does this by doing this, then this, and then this.

        Args:
            `arg1` (type): Description of `arg1`.
            `arg2` (type): Description of `arg2`.

        Returns:
            `type`: Description of return value.

        Examples:
            ```Python
            from module import func

            # Get return value and store in variable
            return_value = func(arg1, arg2)

            # Use return value
            print(return_value)
            ```

        Notes:
            Any additional notes about the function.
        """
        return arg1 + arg2
    ````

**Formatting:**

The docstrings should be formatted as follows:

1. **Description and Purpose:** Start with a description and purpose of the code, followed by an explanation of how the code works.
2. **Args:** The Args section should be formatted as `arg_name` (`arg_type`): `arg_description`. Ensure that `arg_name` is in backticks, the type is in parentheses followed by a colon, and then the description.
3. **Returns:** The Returns section should be formatted as `return_type`: `return_description`. The return type should be in parentheses.

    > **Note:** If the return can be better explained with a name, follow the pattern of the Args section. For instance:

    > ```Python
    > `model` (type): Description of `model`.
    > ```

4. **Examples:** The Examples section should be formatted as a code block using triple backticks, with `Python` explicitly stated. This is the one part of the code where comments are encouraged.
5. **Notes:** The Notes section should be used to explain any additional information about the code.
